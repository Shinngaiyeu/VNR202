# Hướng Dẫn Thiết Lập Firebase

## Bước 1: Tạo Project Firebase

1. Truy cập [Firebase Console](https://console.firebase.google.com/)
2. Click "Add project" hoặc "Thêm dự án"
3. Nhập tên project (ví dụ: `historical-website`)
4. (Tùy chọn) Tắt Google Analytics nếu không cần
5. Click "Create project"

## Bước 2: Tạo Web App

1. Trong Firebase Console, click vào icon Web `</>`
2. Đăng ký app với nickname (ví dụ: `Historical Website`)
3. **KHÔNG** cần chọn Firebase Hosting
4. Click "Register app"
5. Copy thông tin `firebaseConfig` hiển thị

## Bước 3: Cấu hình .env.local

Mở file `.env.local` và thay thế các giá trị bằng thông tin từ Firebase:

```env
NEXT_PUBLIC_FIREBASE_API_KEY=AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=your-project.firebaseapp.com
NEXT_PUBLIC_FIREBASE_PROJECT_ID=your-project-id
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=your-project.appspot.com
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=123456789012
NEXT_PUBLIC_FIREBASE_APP_ID=1:123456789012:web:abcdef123456
NEXT_PUBLIC_FIREBASE_DATABASE_URL=https://your-project-default-rtdb.asia-southeast1.firebasedatabase.app
```

**Lưu ý**: `NEXT_PUBLIC_FIREBASE_DATABASE_URL` rất quan trọng cho Realtime Database!

## Bước 4: Tạo Realtime Database

1. Trong Firebase Console, chọn "Realtime Database" từ menu bên trái
2. Click "Create Database"
3. Chọn location (ví dụ: `Asia Southeast (singapore)` cho Singapore)
4. Chọn mode:
   - **Locked mode**: Yêu cầu authentication (khuyên dùng production)
   - **Test mode**: Cho phép đọc/ghi trong 30 ngày (khuyên dùng để test)
5. Click "Enable"
6. **Quan trọng**: Copy Database URL (ví dụ: `https://your-project-default-rtdb.asia-southeast1.firebasedatabase.app`)

## Bước 5: Cấu hình Security Rules (Quan trọng!)

Trong Realtime Database > Rules, thay thế bằng:

### Cho Development (Test):
```json
{
  "rules": {
    "gameResults": {
      ".read": true,
      ".write": true
    }
  }
}
```

### Cho Production (Khuyên dùng):
```json
{
  "rules": {
    "gameResults": {
      ".read": true,
      "$resultId": {
        ".write": "newData.hasChildren(['playerName', 'round', 'playTime'])",
        ".validate": "newData.child('playerName').isString() && newData.child('round').isNumber() && newData.child('playTime').isNumber()"
      }
    }
  }
}
```

## Bước 6: Restart Development Server

Sau khi cấu hình xong:

```bash
# Dừng server hiện tại (Ctrl + C)
# Chạy lại server
pnpm dev
```

## Bước 7: Kiểm Tra

1. Chơi game và hoàn thành (thắng hoặc thua)
2. Kiểm tra Firebase Console > Firestore Database
3. Bạn sẽ thấy collection `gameResults` với các documents mới

## Cấu Trúc Dữ Liệu Trong Realtime Database

Path: `/gameResults/{autoGeneratedId}`

Data structure:
```javascript
{
  "-NxAbCdEfGhIjKlM": {
    playerName: "Tên người chơi",
    round: 6,                    // Số vòng hoàn thành
    playTime: 180,               // Thời gian chơi (giây)
    timestamp: 1702345678900,    // Milliseconds (tự động)
    score: 75,                   // Điểm số
    defense: 45,                 // Chỉ số quốc phòng
    food: 30,                    // Chỉ số lương thực
    morale: 0                    // Chỉ số dân tâm
  },
  "-NxAbCdEfGhIjKlN": {
    // Kết quả khác...
  }
}
```

## Troubleshooting

### Lỗi: "Firebase: Error (auth/api-key-not-valid)"
- Kiểm tra lại API Key trong `.env.local`
- Đảm bảo không có khoảng trắng thừa

### Lỗi: "Missing or insufficient permissions"
- Kiểm tra Firestore Security Rules
- Đảm bảo đã publish rules mới

### Lỗi: Module not found "@/lib/firebase"
- Restart development server
- Xóa folder `.next` và chạy lại `pnpm dev`

### Không thấy dữ liệu trong Firestore
- Mở Console browser (F12) để xem logs
- Kiểm tra có lỗi gì không
- Kiểm tra Internet connection

## Xem Dữ Liệu

### Cách 1: Trên Firebase Console
1. Vào Firebase Console > Realtime Database
2. Click vào tab "Data"
3. Xem node `gameResults` với các record con

### Cách 2: Trên Website
Truy cập: http://localhost:3000/game/firebase-results

## Ưu điểm của Realtime Database

✅ **Đơn giản hơn**: Không cần query phức tạp như Firestore
✅ **Realtime**: Dữ liệu sync tự động (có thể thêm listener sau)
✅ **Chi phí thấp**: Miễn phí đến 1GB data + 10GB bandwidth/tháng
✅ **Nhanh**: Latency thấp hơn Firestore
✅ **JSON format**: Dễ hiểu và debug
